{
  "version": 4,
  "terraform_version": "0.13.1",
  "serial": 60,
  "lineage": "23cbc83a-7e4c-c4ae-b735-3c2938ff2c3a",
  "outputs": {
    "sg_id": {
      "value": "sg-04f390746ff4aa556",
      "type": "string"
    }
  },
  "resources": [
    {
      "mode": "data",
      "type": "aws_secretsmanager_secret",
      "name": "secrets",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:ap-southeast-1:662769906594:secret:/pipeline/bazaar-db-dms-0KW3OE",
            "description": "",
            "id": "arn:aws:secretsmanager:ap-southeast-1:662769906594:secret:/pipeline/bazaar-db-dms-0KW3OE",
            "kms_key_id": "",
            "name": "/pipeline/bazaar-db-dms",
            "policy": "",
            "rotation_enabled": false,
            "rotation_lambda_arn": "",
            "rotation_rules": [],
            "tags": {
              "service": "pipeline"
            }
          }
        }
      ]
    },
    {
      "mode": "data",
      "type": "aws_secretsmanager_secret_version",
      "name": "current",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:secretsmanager:ap-southeast-1:662769906594:secret:/pipeline/bazaar-db-dms-0KW3OE",
            "id": "arn:aws:secretsmanager:ap-southeast-1:662769906594:secret:/pipeline/bazaar-db-dms-0KW3OE|AWSCURRENT",
            "secret_binary": "",
            "secret_id": "arn:aws:secretsmanager:ap-southeast-1:662769906594:secret:/pipeline/bazaar-db-dms-0KW3OE",
            "secret_string": "{\"rds_name\":\"datacenter-rr\",\"username\":\"dba\",\"password\":\"BazaaRdukaan123!\",\"port\":\"3306\",\"server_name\":\"datacenter-rr.cexzwvlz1pme.ap-southeast-1.rds.amazonaws.com\"}",
            "version_id": "a59aa228-3d12-4959-acf5-f5867aa6a8c0",
            "version_stage": "AWSCURRENT",
            "version_stages": [
              "AWSCURRENT"
            ]
          }
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dms_endpoint",
      "name": "destination",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "certificate_arn": "",
            "database_name": null,
            "elasticsearch_settings": [],
            "endpoint_arn": "arn:aws:dms:ap-southeast-1:662769906594:endpoint:SBYB2HD3UZPNQHZKPYZWIXQHY253M6AIMCCJLSA",
            "endpoint_id": "prod-bazaar-s3-dest-endpoint",
            "endpoint_type": "target",
            "engine_name": "s3",
            "extra_connection_attributes": "addColumnName=true;bucketName=bazaar-prod-data-lake;compressionType=NONE;dataFormat=parquet;datePartitionEnabled=false;encodingType=plain-dictionary;includeOpForFullLoad=true;parquetTimestampInMillisecond=true;",
            "id": "prod-bazaar-s3-dest-endpoint",
            "kafka_settings": [],
            "kinesis_settings": [],
            "kms_key_arn": "",
            "mongodb_settings": [],
            "password": null,
            "port": null,
            "s3_settings": [
              {
                "bucket_folder": "",
                "bucket_name": "bazaar-prod-data-lake",
                "compression_type": "NONE",
                "csv_delimiter": ",",
                "csv_row_delimiter": "\\n",
                "external_table_definition": "",
                "service_access_role_arn": "arn:aws:iam::662769906594:role/etl/prod_bazaar_rds_dms_role"
              }
            ],
            "server_name": null,
            "service_access_role": null,
            "ssl_mode": "none",
            "tags": {
              "service": "data-lake"
            },
            "username": null
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.bazaar_rds_dms_role"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dms_endpoint",
      "name": "source",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "certificate_arn": "",
            "database_name": "",
            "elasticsearch_settings": [],
            "endpoint_arn": "arn:aws:dms:ap-southeast-1:662769906594:endpoint:TCBLAPDGYF2C6WW5PE74SBBZRKOUMQOGE2W6KDI",
            "endpoint_id": "prod-bazaar-rds-src-endpoint",
            "endpoint_type": "source",
            "engine_name": "mysql",
            "extra_connection_attributes": "",
            "id": "prod-bazaar-rds-src-endpoint",
            "kafka_settings": [],
            "kinesis_settings": [],
            "kms_key_arn": "arn:aws:kms:ap-southeast-1:662769906594:key/f1561cd5-dcec-466d-93d8-a59c22aca5b9",
            "mongodb_settings": [],
            "password": "BazaaRdukaan123!",
            "port": 3306,
            "s3_settings": [],
            "server_name": "datacenter-rr.cexzwvlz1pme.ap-southeast-1.rds.amazonaws.com",
            "service_access_role": null,
            "ssl_mode": "none",
            "tags": {
              "service": "data-lake"
            },
            "username": "dba"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "data.aws_secretsmanager_secret_version.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dms_replication_instance",
      "name": "replication_instance",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "allocated_storage": 50,
            "allow_major_version_upgrade": null,
            "apply_immediately": false,
            "auto_minor_version_upgrade": true,
            "availability_zone": "ap-southeast-1a",
            "engine_version": "3.4.3",
            "id": "prod-dms-bazaar-rds-dms-instance",
            "kms_key_arn": "arn:aws:kms:ap-southeast-1:662769906594:key/f1561cd5-dcec-466d-93d8-a59c22aca5b9",
            "multi_az": false,
            "preferred_maintenance_window": "sun:10:30-sun:14:30",
            "publicly_accessible": false,
            "replication_instance_arn": "arn:aws:dms:ap-southeast-1:662769906594:rep:WK5H36X2NCRSPNHZR2UWJKFO3O22JAXVBRUJ5IA",
            "replication_instance_class": "dms.t3.small",
            "replication_instance_id": "prod-dms-bazaar-rds-dms-instance",
            "replication_instance_private_ips": [
              "192.168.120.227"
            ],
            "replication_instance_public_ips": [
              ""
            ],
            "replication_subnet_group_id": "prod-dms-bazaar-subnet-group",
            "tags": {
              "service": "data-lake"
            },
            "timeouts": null,
            "vpc_security_group_ids": [
              "sg-04f390746ff4aa556"
            ]
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjoxODAwMDAwMDAwMDAwLCJkZWxldGUiOjE4MDAwMDAwMDAwMDAsInVwZGF0ZSI6MTgwMDAwMDAwMDAwMH19",
          "dependencies": [
            "aws_dms_replication_subnet_group.subnet_group",
            "aws_security_group.dms_sg"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dms_replication_subnet_group",
      "name": "subnet_group",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "prod-dms-bazaar-subnet-group",
            "replication_subnet_group_arn": "arn:aws:dms:ap-southeast-1:662769906594:subgrp:prod-dms-bazaar-subnet-group",
            "replication_subnet_group_description": "Bazaar RDS Replication subnet group",
            "replication_subnet_group_id": "prod-dms-bazaar-subnet-group",
            "subnet_ids": [
              "subnet-00badf099843be4db",
              "subnet-01d3a5438c0a9f7c0",
              "subnet-03c442ec5eac9187a"
            ],
            "tags": {
              "service": "data-lake"
            },
            "vpc_id": "vpc-014f668857c36d3b6"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_dms_replication_task",
      "name": "replication_task",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "cdc_start_time": null,
            "id": "prod-dms-bazaar-rds-replication-task",
            "migration_type": "full-load-and-cdc",
            "replication_instance_arn": "arn:aws:dms:ap-southeast-1:662769906594:rep:WK5H36X2NCRSPNHZR2UWJKFO3O22JAXVBRUJ5IA",
            "replication_task_arn": "arn:aws:dms:ap-southeast-1:662769906594:task:LRW4SQAE7TB5326F3BHNDRA2TPVB7BASBMGA6KY",
            "replication_task_id": "prod-dms-bazaar-rds-replication-task",
            "replication_task_settings": "{\"TargetMetadata\":{\"TargetSchema\":\"\",\"SupportLobs\":true,\"FullLobMode\":false,\"LobChunkSize\":0,\"LimitedSizeLobMode\":true,\"LobMaxSize\":32,\"InlineLobMaxSize\":0,\"LoadMaxFileSize\":0,\"ParallelLoadThreads\":0,\"ParallelLoadBufferSize\":0,\"BatchApplyEnabled\":false,\"TaskRecoveryTableEnabled\":false,\"ParallelLoadQueuesPerThread\":0,\"ParallelApplyThreads\":0,\"ParallelApplyBufferSize\":0,\"ParallelApplyQueuesPerThread\":0},\"FullLoadSettings\":{\"TargetTablePrepMode\":\"DO_NOTHING\",\"CreatePkAfterFullLoad\":false,\"StopTaskCachedChangesApplied\":false,\"StopTaskCachedChangesNotApplied\":false,\"MaxFullLoadSubTasks\":8,\"TransactionConsistencyTimeout\":600,\"CommitRate\":10000},\"Logging\":{\"EnableLogging\":false,\"LogComponents\":[{\"Id\":\"TRANSFORMATION\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"SOURCE_UNLOAD\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"IO\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"TARGET_LOAD\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"PERFORMANCE\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"SOURCE_CAPTURE\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"SORTER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"REST_SERVER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"VALIDATOR_EXT\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"TARGET_APPLY\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"TASK_MANAGER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"TABLES_MANAGER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"METADATA_MANAGER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"FILE_FACTORY\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"COMMON\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"ADDONS\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"DATA_STRUCTURE\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"COMMUNICATION\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"},{\"Id\":\"FILE_TRANSFER\",\"Severity\":\"LOGGER_SEVERITY_DEFAULT\"}],\"CloudWatchLogGroup\":null,\"CloudWatchLogStream\":null},\"ControlTablesSettings\":{\"historyTimeslotInMinutes\":5,\"ControlSchema\":\"\",\"HistoryTimeslotInMinutes\":5,\"HistoryTableEnabled\":false,\"SuspendedTablesTableEnabled\":false,\"StatusTableEnabled\":false},\"StreamBufferSettings\":{\"StreamBufferCount\":3,\"StreamBufferSizeInMB\":8,\"CtrlStreamBufferSizeInMB\":5},\"ChangeProcessingDdlHandlingPolicy\":{\"HandleSourceTableDropped\":true,\"HandleSourceTableTruncated\":true,\"HandleSourceTableAltered\":true},\"ErrorBehavior\":{\"DataErrorPolicy\":\"LOG_ERROR\",\"DataTruncationErrorPolicy\":\"LOG_ERROR\",\"DataErrorEscalationPolicy\":\"SUSPEND_TABLE\",\"DataErrorEscalationCount\":0,\"TableErrorPolicy\":\"SUSPEND_TABLE\",\"TableErrorEscalationPolicy\":\"STOP_TASK\",\"TableErrorEscalationCount\":0,\"RecoverableErrorCount\":-1,\"RecoverableErrorInterval\":5,\"RecoverableErrorThrottling\":true,\"RecoverableErrorThrottlingMax\":1800,\"RecoverableErrorStopRetryAfterThrottlingMax\":true,\"ApplyErrorDeletePolicy\":\"IGNORE_RECORD\",\"ApplyErrorInsertPolicy\":\"LOG_ERROR\",\"ApplyErrorUpdatePolicy\":\"LOG_ERROR\",\"ApplyErrorEscalationPolicy\":\"LOG_ERROR\",\"ApplyErrorEscalationCount\":0,\"ApplyErrorFailOnTruncationDdl\":false,\"FullLoadIgnoreConflicts\":true,\"FailOnTransactionConsistencyBreached\":false,\"FailOnNoTablesCaptured\":false},\"ChangeProcessingTuning\":{\"BatchApplyPreserveTransaction\":true,\"BatchApplyTimeoutMin\":1,\"BatchApplyTimeoutMax\":30,\"BatchApplyMemoryLimit\":500,\"BatchSplitSize\":0,\"MinTransactionSize\":1000,\"CommitTimeout\":1,\"MemoryLimitTotal\":1024,\"MemoryKeepTime\":60,\"StatementCacheSize\":50},\"PostProcessingRules\":null,\"CharacterSetSettings\":null,\"LoopbackPreventionSettings\":null,\"BeforeImageSettings\":null}",
            "source_endpoint_arn": "arn:aws:dms:ap-southeast-1:662769906594:endpoint:TCBLAPDGYF2C6WW5PE74SBBZRKOUMQOGE2W6KDI",
            "table_mappings": "{\"rules\":[{\"filters\":[],\"object-locator\":{\"schema-name\":\"bazaar%\",\"table-name\":\"%\"},\"rule-action\":\"include\",\"rule-id\":\"1\",\"rule-name\":\"all-bazaar-databases\",\"rule-type\":\"selection\"}]}",
            "tags": {
              "service": "data-lake"
            },
            "target_endpoint_arn": "arn:aws:dms:ap-southeast-1:662769906594:endpoint:SBYB2HD3UZPNQHZKPYZWIXQHY253M6AIMCCJLSA"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_dms_endpoint.destination",
            "aws_dms_endpoint.source",
            "aws_dms_replication_instance.replication_instance",
            "aws_dms_replication_subnet_group.subnet_group",
            "aws_iam_role.bazaar_rds_dms_role",
            "aws_security_group.dms_sg",
            "data.aws_secretsmanager_secret_version.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_instance_profile",
      "name": "bazaar_rds_dms_profile",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::662769906594:instance-profile/prod_bazaar_rds_dms_profile",
            "create_date": "2021-01-09T00:06:41Z",
            "id": "prod_bazaar_rds_dms_profile",
            "name": "prod_bazaar_rds_dms_profile",
            "name_prefix": null,
            "path": "/",
            "role": "prod_bazaar_rds_dms_role",
            "unique_id": "AIPAZUUBKGORIZHQ3FE6S"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.bazaar_rds_dms_role"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role",
      "name": "bazaar_rds_dms_role",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "arn": "arn:aws:iam::662769906594:role/etl/prod_bazaar_rds_dms_role",
            "assume_role_policy": "{\"Version\":\"2012-10-17\",\"Statement\":[{\"Sid\":\"\",\"Effect\":\"Allow\",\"Principal\":{\"Service\":\"dms.amazonaws.com\"},\"Action\":\"sts:AssumeRole\"}]}",
            "create_date": "2021-01-09T00:06:39Z",
            "description": "",
            "force_detach_policies": false,
            "id": "prod_bazaar_rds_dms_role",
            "max_session_duration": 3600,
            "name": "prod_bazaar_rds_dms_role",
            "name_prefix": null,
            "path": "/etl/",
            "permissions_boundary": null,
            "tags": null,
            "unique_id": "AROAZUUBKGORCNTEG5XDU"
          },
          "private": "bnVsbA=="
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_iam_role_policy",
      "name": "bazaar_rds_dms_policy",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 0,
          "attributes": {
            "id": "prod_bazaar_rds_dms_role:prod_bazaar_rds_dms_policy",
            "name": "prod_bazaar_rds_dms_policy",
            "name_prefix": null,
            "policy": "{\r\n  \"Version\": \"2012-10-17\",\r\n  \"Statement\": [\r\n      {\r\n          \"Effect\": \"Allow\",\r\n          \"Action\": \"s3:*\",\r\n          \"Resource\": \"arn:aws:s3:::bazaar-prod-data-lake\"\r\n      },\r\n      {\r\n          \"Effect\": \"Allow\",\r\n          \"Action\": \"rds:*\",\r\n          \"Resource\": \"arn:aws:rds:ap-southeast-1:662769906594:db:datacenter-rr\"\r\n      },\r\n      {\r\n          \"Action\": [\r\n              \"cloudformation:CreateChangeSet\",\r\n              \"cloudformation:DescribeChangeSet\",\r\n              \"cloudformation:DescribeStackResource\",\r\n              \"cloudformation:DescribeStacks\",\r\n              \"cloudformation:ExecuteChangeSet\",\r\n              \"ec2:DescribeSecurityGroups\",\r\n              \"ec2:DescribeSubnets\",\r\n              \"ec2:DescribeVpcs\",\r\n              \"kms:DescribeKey\",\r\n              \"kms:ListAliases\",\r\n              \"kms:ListKeys\",\r\n              \"lambda:ListFunctions\",\r\n              \"rds:DescribeDBClusters\",\r\n              \"rds:DescribeDBInstances\",\r\n              \"tag:GetResources\"\r\n          ],\r\n          \"Effect\": \"Allow\",\r\n          \"Resource\": \"*\"\r\n      }\r\n  ]\r\n}\r\n",
            "role": "prod_bazaar_rds_dms_role"
          },
          "private": "bnVsbA==",
          "dependencies": [
            "aws_iam_role.bazaar_rds_dms_role",
            "data.aws_secretsmanager_secret_version.current"
          ]
        }
      ]
    },
    {
      "mode": "managed",
      "type": "aws_security_group",
      "name": "dms_sg",
      "provider": "provider[\"registry.terraform.io/hashicorp/aws\"]",
      "instances": [
        {
          "schema_version": 1,
          "attributes": {
            "arn": "arn:aws:ec2:ap-southeast-1:662769906594:security-group/sg-04f390746ff4aa556",
            "description": "Managed by Terraform",
            "egress": [
              {
                "cidr_blocks": [],
                "description": "Allow all traffic to RDS port",
                "from_port": 3306,
                "ipv6_cidr_blocks": [],
                "prefix_list_ids": [],
                "protocol": "tcp",
                "security_groups": [
                  "sg-0524d0ef863222246"
                ],
                "self": false,
                "to_port": 3306
              }
            ],
            "id": "sg-04f390746ff4aa556",
            "ingress": [],
            "name": "prod-dms-rds-datalake-bazaar-sg",
            "name_prefix": "",
            "owner_id": "662769906594",
            "revoke_rules_on_delete": false,
            "tags": {
              "environment": "prod",
              "iac_provider": "terraform",
              "uses_iac": "true"
            },
            "timeouts": null,
            "vpc_id": "vpc-014f668857c36d3b6"
          },
          "private": "eyJlMmJmYjczMC1lY2FhLTExZTYtOGY4OC0zNDM2M2JjN2M0YzAiOnsiY3JlYXRlIjo2MDAwMDAwMDAwMDAsImRlbGV0ZSI6NjAwMDAwMDAwMDAwfSwic2NoZW1hX3ZlcnNpb24iOiIxIn0="
        }
      ]
    }
  ]
}
